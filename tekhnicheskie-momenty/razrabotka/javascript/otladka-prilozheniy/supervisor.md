---
order: 1
title: supervisor
---

–ï—Å–ª–∏ —Ç–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ NestJS –ø–∞–¥–∞–µ—Ç –∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `supervisorctl`, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—â–µ–π:

---

## 1\. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Supervisor**

Supervisor –æ–±—ã—á–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç. –ù–∞–π–¥–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Supervisor –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –≤ `/etc/supervisor/conf.d/myapp.conf`) –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, –≥–¥–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ª–æ–≥–∏:

```
[program:myapp]
command=node dist/main.js
autostart=true
autorestart=true
stderr_logfile=/var/log/myapp_err.log
stdout_logfile=/var/log/myapp_out.log
```

### –ü—Ä–æ–≤–µ—Ä—å –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö:

```
cat /var/log/myapp_err.log
cat /var/log/myapp_out.log
```

–ò–ª–∏ –º–æ–∂–µ—à—å —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```
tail -f /var/log/myapp_err.log
```

---

## 2\. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ NestJS**

–ï—Å–ª–∏ Supervisor –Ω–µ –¥–∞—ë—Ç —Ç–µ–±–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –¥–æ–±–∞–≤—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ NestJS.

### –î–æ–±–∞–≤—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `main.ts`

```
import { Logger } from '@nestjs/common';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  const port = process.env.PORT || 3000;
  await app.listen(port);

  Logger.log(`Application is running on: http://localhost:${port}`);
}

bootstrap().catch((err) => {
  Logger.error('Error during app bootstrap:', err);
});
```

–ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é:

```
node dist/main.js
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –µ—Å—Ç—å, —Ç—ã –µ—ë —É–≤–∏–¥–∏—à—å —Å—Ä–∞–∑—É.

---

## 3\. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ Supervisor**

–í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É:

```
supervisorctl status
```

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π –µ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```
supervisorctl restart myapp
```

–ï—Å–ª–∏ –æ–Ω–æ —Å—Ä–∞–∑—É –∂–µ –ø–∞–¥–∞–µ—Ç, –ø–æ—Å–º–æ—Ç—Ä–∏ —Å—Ç–∞—Ç—É—Å —Å–Ω–æ–≤–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å, –Ω–µ—Ç –ª–∏ —Ç–∞–º –ø—Ä–∏—á–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

---

## 4\. **–ü–æ—Å–º–æ—Ç—Ä–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ Supervisor**

–ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –ø–∞–¥–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ Supervisor:

```
cat /var/log/supervisor/supervisord.log
```

---

## 5\. **–í–∫–ª—é—á–∏ autorestart –∏ limit**

–ï—Å–ª–∏ —Ç–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏, –Ω–æ Supervisor –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ, –ø—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥:

```
[program:myapp]
command=node dist/main.js
autostart=true
autorestart=true
startretries=5
stderr_logfile=/var/log/myapp_err.log
stdout_logfile=/var/log/myapp_out.log
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –∑–∞–±—É–¥—å –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Supervisor:

```
supervisorctl reread
supervisorctl update
supervisorctl restart myapp
```

---

## 6\. **–û—Ç–ª–æ–≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ NestJS**

–î–æ–±–∞–≤—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫:

```
import { ArgumentsHost, Catch, ExceptionFilter, Logger } from '@nestjs/common';

@Catch()
export class GlobalExceptionFilter implements ExceptionFilter {
  private readonly logger = new Logger(GlobalExceptionFilter.name);

  catch(exception: any, host: ArgumentsHost) {
    this.logger.error('Unhandled exception', exception);
  }
}
```

–ò –ø–æ–¥–∫–ª—é—á–∏ –µ–≥–æ –≤ `main.ts`:

```
app.useGlobalFilters(new GlobalExceptionFilter());
```

---

## 7\. **–ü—Ä–æ–≤–µ—Ä—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏, –ø–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏:

```
dmesg | grep -i 'oom'
```

–ï—Å–ª–∏ –µ—Å—Ç—å `Out of memory`, –ø–æ–ø—Ä–æ–±—É–π —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PM2 –≤–º–µ—Å—Ç–æ Supervisor.

---

### –ò—Ç–æ–≥

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Supervisor (`/var/log/myapp_err.log`).

2. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é (`node dist/main.js`).

3. –ü–æ—Å–º–æ—Ç—Ä–∏ `supervisorctl status`.

4. –í–∫–ª—é—á–∏ `autorestart=true` –≤ –∫–æ–Ω—Ñ–∏–≥–µ Supervisor.

5. –î–æ–±–∞–≤—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –≤ NestJS.



Supervisor –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `msExcel`, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª `SIGQUIT`, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞**. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

## 1\. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∞–º–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É**

NestJS –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –∏–∑-–∑–∞:

-  –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫.

-  –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ `unhandledRejection` –∏–ª–∏ `uncaughtException`.

-  –£—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –≤ –∫–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `process.exit(1)`).

üîπ **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ `main.ts`:

```
process.on('uncaughtException', (err) => {
  console.error('Uncaught Exception:', err);
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('Unhandled Rejection:', reason);
});
```

---

## 2\. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –ø–∞–º—è—Ç–∏ (OOM)**

–°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —É–±–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏.

üîπ **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —è–¥—Ä–∞:**

```
dmesg | grep -i 'oom'
```

–ï—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞ `Out of memory`, —Ç–æ –ø—Ä–∏—á–∏–Ω–∞ –≤ –Ω–µ—Ö–≤–∞—Ç–∫–µ RAM.

üîπ **–†–µ—à–µ–Ω–∏–µ:**

-  –£–≤–µ–ª–∏—á–∏—Ç—å –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏.

-  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PM2` –≤–º–µ—Å—Ç–æ `Supervisor`, —Ç–∞–∫ –∫–∞–∫ —É –Ω–µ–≥–æ –µ—Å—Ç—å –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏.

---

## 3\. **Supervisor –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ –æ—à–∏–±–∫–∞–º**

–ï—Å–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `supervisor.conf` —É–∫–∞–∑–∞–Ω—ã —É—Å–ª–æ–≤–∏—è `exitcodes`, `stopwaitsecs`, Supervisor –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.

üîπ **–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥:**

```
cat /etc/supervisor/conf.d/msExcel.conf
```

–ï—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å:

```
exitcodes=0
stopwaitsecs=10
```

–ü–æ–ø—Ä–æ–±—É–π —É–±—Ä–∞—Ç—å `exitcodes` –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å `stopwaitsecs`.

---

## 4\. **–û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ**

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ, –ø–æ–ø—Ä–æ–±—É–π –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –≤—Ä—É—á–Ω—É—é:

```
node dist/main.js
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –æ–Ω–∏ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã.

---

## 5\. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏**

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ExcelJS` –∏–ª–∏ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏, –æ–Ω–∏ –º–æ–≥—É—Ç –ø–∞–¥–∞—Ç—å –∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

üîπ **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```
rm -rf node_modules package-lock.json
npm install
```

---

## –í—ã–≤–æ–¥

–ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ -- –ª–∏–±–æ **—Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å (**`OOM`**)**, –ª–∏–±–æ **NestJS –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏**. –ü—Ä–æ–≤–µ—Ä—å:

1. **–õ–æ–≥–∏ Supervisor** (`/var/log/msExcel_err.log`).

2. **–õ–æ–≥–∏ —è–¥—Ä–∞ –Ω–∞ OOM** (`dmesg | grep -i 'oom'`).

3. **–ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é** (`node dist/main.js`).

4. **–ö–æ–Ω—Ñ–∏–≥ Supervisor** (`cat /etc/supervisor/conf.d/msExcel.conf`).

–î–∞–π –º–Ω–µ –±–æ–ª—å—à–µ –ª–æ–≥–æ–≤, –µ—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. üöÄ